<metal:main use-macro="load: layout.pt" tal:define="user dataset.user">
    <metal:script fill-slot="style">
    </metal:script>
    <metal:container fill-slot="container">
        <div class="span2">
            <ul class="nav nav-list bamboo-actions-sidenav" data-spy="affix">
                <li><a href="#info"><i class="icon-chevron-right"></i>
                    Info</a></li>
                <li><a href="#calculations"><i class="icon-chevron-right"></i>
                    Calculations</a></li>
                <li><a href="#aggregations"><i class="icon-chevron-right"></i>
                    Aggregations</a>
                </li>
            </ul>
        </div>
        <div class="span10">
            <section id="info" ng-controller="InfoCtrl">
                <h2>${dataset.title}</h2>
                <form>
                    <fieldset>
                        <label>Update Dataset name</label>
                        <input type="text" placeholder="e.g. Students Survey" name="name" ng-model="dataset.label"/>
                        <br/>
                        <button ng-click="updateLabel(dataset.label)" class="btn">Update
                        </button>
                    </fieldset>
                </form>
                <h3>Fields</h3>
                <table class="table">
                    <thead>
                    <tr>
                        <td>#</td>
                        <td>ID</td>
                        <td>label</td>
                        <td>simple type</td>
                        <td>olap type</td>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="(field, def) in info.schema">
                        <td>{{$index + 1}}</td>
                        <td>{{field}}</td>
                        <td>{{def.label}}</td>
                        <td>{{def.simpletype}}</td>
                        <td>{{def.olap_type}}</td>
                    </tr>
                    </tbody>
                </table>
            </section>

            <section id="calculations" ng-controller="CalculationsCtrl">
                <h2>Calculations</h2>
                <form>
                    <fieldset>
                        <label>Calculation name</label>
                        <input type="text" placeholder="e.g. is_rich"
                               name="name" ng-model="new_calculation.name"/>
                        <label>Formula</label>
                        <input type="text" placeholder="e.g. income>50"
                               name="formula"
                               ng-model="new_calculation.formula"/>
                        <br/>
                        <button ng-click="createCalculation(calculation)"
                                class="btn">Create
                        </button>
                    </fieldset>
                </form>
                <table class="table">
                    <thead>
                    <tr>
                        <td>#</td>
                        <td>name</td>
                        <td>formula</td>
                        <td>state</td>
                        <td>Actions</td>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="calculation in calculations">
                        <td>{{$index + 1}}</td>
                        <td>{{calculation.name}}</td>
                        <td>{{calculation.formula}}</td>
                        <td>{{calculation.state}}</td>
                        <td>
                            <button class="btn"
                                    ng-click="removeCalculation(calculation)"><i
                                    class="icon-trash"></i></button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </section>

            <section id="aggregations" ng-controller="AggregationsCtrl">
                <div class="page-header">
                    <h2>Aggregations</h2>
                </div>

            </section>
        </div>
    </metal:container>
    <metal:script fill-slot="script">
        <script type="text/javascript">
        bamboo.settings.URL = '${dataset.bamboo_host}';
        var dataset_id = '${dataset.dataset_id}';
        </script>
    </metal:script>
</metal:main>


